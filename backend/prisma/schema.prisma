generator client {
  provider = "prisma-client-js"
  previewFeatures = ["relationJoins", "omitApi"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Users {
  userId    BigInt   @id @default(autoincrement()) @map("user_id")
  email      String   @unique @db.VarChar(100) @map("email")
  password   String   @db.VarChar(100) @map("password")
  firstname  String   @db.VarChar(100) @map("firstname")
  lastname   String?  @db.VarChar(100) @map("lastname")
  currencyId Int @map("currency_id")
  fk_currency Currencies @relation(fields: [currencyId], references: [currencyId])
  createdAt DateTime @default(now()) @db.Timestamptz(6) @map("created_at")
  updatedAt DateTime @default(now()) @db.Timestamptz(6) @map("updated_at")
  groups     Groups[]
  expenses   Expenses[]
  expenseShares ExpenseShares[]
  groupMembers GroupMembers[]
  @@map("users")
}

model Groups {
  groupId   BigInt    @id @default(autoincrement()) @map("group_id")
  groupType Int @map("group_type")
  fk_grouptype  GroupTypes @relation(fields: [groupType], references: [groupTypeId])
  groupName String    @db.VarChar(100) @map("group_name")
  createdBy BigInt @map("created_by")
  fk_user       Users     @relation(fields: [createdBy], references: [userId])
  status Status @default(ACTIVE) @map("status")
  createdAt DateTime  @default(now()) @db.Timestamptz(6) @map("created_at")
  updatedAt DateTime @default(now()) @db.Timestamptz(6) @map("updated_at")
  expenses Expenses[]
  groupMembers GroupMembers[]
  @@map("groups")
}

model GroupTypes {
  groupTypeId   Int      @id @default(autoincrement()) @map("group_type_id")
  groupTypeName String   @unique @db.VarChar(100) @map("group_type_name")
  groups          Groups[]
  @@map("group_types")
}

model GroupMembers {
  groupId BigInt @map("group_id")
  memberId BigInt @map("member_id")
  fk_group Groups @relation(fields:[groupId], references: [groupId])
  fk_member Users @relation(fields:[memberId], references: [userId])
  @@id([groupId, memberId])
  @@map("group_members")
}

model Currencies {
  currencyId Int @id@default(autoincrement()) @map("currency_id")
  currencyName String @unique @db.VarChar(200) @map("currency_name")
  symbol String @db.VarChar(100) @map("symbol")
  code String @unique @db.VarChar(100) @map("code")
  users Users[]
  expenses Expenses[]
  @@map("currencies")
}

enum Status {
  ACTIVE
  DELETED
}

model Expenses {
  expenseId BigInt   @id @default(autoincrement()) @map("expense_id")
  expenseName String @db.VarChar(200) @map("expense_name")
  expenseStatus String @db.VarChar(20) @default("ACTIVE") @map("expense_status")
  groupId BigInt? @map("group_id")
  fk_group Groups? @relation(fields:[groupId], references: [groupId])
  amount Int @map("amount")
  currencyId Int @map("currency_id")
  fk_currency_id Currencies @relation(fields: [currencyId],references: [currencyId])
  createdAt  DateTime  @default(now()) @db.Timestamptz(6) @map("created_at")
  expenseDate DateTime @default(now()) @db.Timestamptz(6) @map("expense_date")
  createdBy  BigInt @map("created_by")
  fk_user Users @relation(fields: [createdBy],references: [userId])
  isSettled Boolean @default(false) @map("is_settled")
  description String? @db.VarChar(300) @map("description")
  expenseShares ExpenseShares[]
  @@map("expenses")
}

model ExpenseShares{
  expenseShareId BigInt  @id @default(autoincrement()) @map("expense_share_id")
  expenseId BigInt @map("expense_id")
  fk_expense Expenses @relation(fields:[expenseId],references:[expenseId])
  userId BigInt @map("user_id")
  fk_user Users @relation(fields:[userId],references: [userId]) 
  paidAmount Int @default(0) @map("paid_amount")
  owedAmount Int @default(0) @map("owed_amount")
  @@map("expense_shares")
}